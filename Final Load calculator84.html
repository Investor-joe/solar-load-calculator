<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Solar Load Calculator</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Segoe+UI:400,600&display=swap"/>
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #18bc9c;
      --background: #f5f5f5;
      --light: #ffffff;
      --dark: #1e1e1e;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--background);
      color: var(--primary);
    }
    .dark-mode {
      background-color: var(--dark);
      color: #eee;
    }
    .container {
      max-width: 960px;
      margin: auto;
      padding: 20px;
      background: var(--light);
      border-radius: 12px;
    }
    .dark-mode .container {
      background: #2a2a2a;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo {
      max-height: 80px;
    }
    h2 {
      text-align: center;
    }
    .device-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    input, select {
      flex: 1;
      padding: 10px;
      font-size: 14px;
    }
    .result {
      margin-top: 30px;
      padding: 20px;
      background: #e8f6f3;
      border-radius: 10px;
    }
    .dark-mode .result {
      background: #333;
    }
    button {
      padding: 10px 20px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn-primary { background-color: var(--secondary); color: #fff; }
    .btn-secondary { background-color: #f39c12; color: #fff; }
    .btn-danger { background-color: #e74c3c; color: #fff; }
    .controls { display: flex; justify-content: space-between; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="FB_IMG_1728930059328~2_1.jpg" class="logo" alt="Company Logo">
      <button onclick="toggleDarkMode()">🌙 Toggle Dark Mode</button>
    </div>
    <h2>🌞 Solar Load Calculator</h2>
    <div id="devices"></div>
    <div class="controls">
      <button class="btn-secondary" onclick="addDevice()">➕ Add Device</button>
      <button class="btn-primary" onclick="calculateLoad()">⚡ Calculate</button>
      <button onclick="window.print()">🖨️ Print / PDF</button>
      <a href="https://wa.me/234XXXXXXXXXX" target="_blank" class="btn-primary">💬 WhatsApp Quote</a>
    </div>
    <div class="result" id="result" style="display:none;"></div>
  </div>

<script>
let deviceIndex = 0;
const applianceOptions = {
  "Internal Light": 12,
  "Freezer": 300,
  "Fans": 85,
  "TV": 100,
  "Computer": 200,
  "Laptop": 60,
  "Water dispenser": 500,
  "Ceiling Fan": 80,
  "Cake display": 350,
  "Pump": 746,
  "1hp AC": 850,
  "Inverter AC": 1200,
  "Printer": 500,
  "Water heater": 1500,
  "Gas oven": 3000,
  "Fridge": 100
};

function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
}

function addDevice(name = "Fans", hours = '', qty = '') {
  const row = document.createElement('div');
  row.className = 'device-row';
  const options = Object.keys(applianceOptions).map(appl => `<option value="${appl}" ${appl === name ? 'selected' : ''}>${appl}</option>`).join('');
  row.innerHTML = `
    <select id="device${deviceIndex}-name">${options}</select>
    <input type="number" placeholder="Hours/day" value="${hours}" id="device${deviceIndex}-hours">
    <input type="number" placeholder="Qty" value="${qty}" id="device${deviceIndex}-qty">
    <button class="btn-danger" onclick="this.parentElement.remove()">❌</button>
  `;
  document.getElementById('devices').appendChild(row);
  deviceIndex++;
}

function calculateLoad() {
  let totalWh = 0;
  let devices = [];
  let maxHour = 0;

  for (let i = 0; i < deviceIndex; i++) {
    const nameElem = document.getElementById(`device${i}-name`);
    const hours = parseFloat(document.getElementById(`device${i}-hours`)?.value);
    const qty = parseInt(document.getElementById(`device${i}-qty`)?.value);
    if (!nameElem || isNaN(hours) || isNaN(qty)) continue;
    const name = nameElem.value;
    const watt = applianceOptions[name] || 100;
    totalWh += watt * hours * qty;
    devices.push({ name, wattage: watt, quantity: qty });
    if (hours > maxHour) maxHour = hours;
  }

  const inverterData = calculateInverterSize(devices);
  const panelWattage = (totalWh * 1.2) / 3.4;
  const roundedPanel = Math.ceil(panelWattage / 100) * 100; // round to nearest 100W
  const panel = `${roundedPanel}W`;
// Battery calculation logic
const usableKWh = (totalWh / 1000) * 0.8; // Assume 80% usable energy from batteries
const agmUnitKWh = 2; // Each 12V 200Ah AGM battery ≈ 2 kWh usable
const agmOptions = [2, 4, 8]; // Only support 2, 4, or 8 pcs AGM

let batteryText = '';
let agmQty = agmOptions.find(n => n * agmUnitKWh >= usableKWh);

if (agmQty) {
  const agmKWh = agmQty * agmUnitKWh;
  let lithiumHint = "";

  if (agmQty === 4) lithiumHint = " (or 7.5 kWh Lithium)";
  if (agmQty === 8) lithiumHint = " (or 15 kWh Lithium)";

  batteryText = `<strong>AGM Batteries:</strong> ${agmQty} × 12V 200Ah (≈ ${agmKWh} kWh usable)${lithiumHint}`;
} else {
  // AGM not sufficient – recommend lithium only
  const lithiumMap = [
    { size: "5 kWh", max: 5 },
    { size: "7.5 kWh", max: 7.5 },
    { size: "10 kWh", max: 10 },
    { size: "15 kWh", max: 15 }
  ];
  const lithiumMatch = lithiumMap.find(b => usableKWh <= b.max);
  const lithiumText = lithiumMatch ? lithiumMatch.size : "15+ kWh";

  batteryText = `<strong>Recommended Battery:</strong> ${lithiumText} Lithium Battery (AGM not sufficient)`;
}
document.getElementById('result').style.display = 'block';

document.getElementById('result').innerHTML = `
  <h3>🔋 Recommended Solar System</h3>
  <p><strong>Total Load (Wh/day):</strong> ${totalWh.toFixed(1)} Wh</p>
  <p><strong>Inverter:</strong> ${inverterData.suggestedInverter} (${inverterData.requiredInverterWatts.toFixed(1)} W)</p>
  <p><strong>Solar Panel Size:</strong> ${panel}</p>
  <p>${batteryText}</p>
`;

}
function calculateInverterSize(devices, safetyMargin = 1.3) {
  let totalLoad = 0;
  devices.forEach(device => {
    totalLoad += device.wattage * device.quantity;
  });
  const inverterSizeWatts = totalLoad * safetyMargin;
  let suggestedSize;
  if (inverterSizeWatts <= 800) suggestedSize = '1kVA';
  else if (inverterSizeWatts <= 1200) suggestedSize = '1.5kVA';
  else if (inverterSizeWatts <= 1600) suggestedSize = '2kVA';
  else if (inverterSizeWatts <= 3000) suggestedSize = '3kVA';
  else if (inverterSizeWatts <= 5000) suggestedSize = '5kVA';
  else if (inverterSizeWatts <= 7500) suggestedSize = '7.5kVA';
  else suggestedSize = '10kVA+';

  return {
    totalLoadWatts: totalLoad,
    requiredInverterWatts: inverterSizeWatts,
    suggestedInverter: suggestedSize
  };
}
window.onload = () => {
  document.getElementById('devices').innerHTML = ''; // Clear any existing
  deviceIndex = 0; // Reset index to avoid ID conflicts
  addDevice("Fans", 1, 0);           // Default Fans
  addDevice("Internal Light", 2, 0); // Default Internal Light
};

</script>
</body>
</html>
